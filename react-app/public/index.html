<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Musk Monitor</title>
  <style>
    :root { --primary: #3b82f6; --bg: #f0f9ff; --bg-card: #ffffff; --text: #1e293b; --text-secondary: #64748b; --text-muted: #94a3b8; --border: #e2e8f0; --green: #10b981; --red: #ef4444; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; height: 100vh; overflow: hidden; }
    .sidebar { width: 220px; background: var(--bg-card); border-right: 1px solid var(--border); padding: 20px; height: 100vh; position: fixed; left: 0; top: 0; display: flex; flex-direction: column; }
    .logo { display: flex; align-items: center; gap: 10px; margin-bottom: 30px; }
    .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--primary), #06b6d4); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: white; }
    .logo-text { font-size: 18px; font-weight: 700; color: var(--primary); }
    .menu-item { display: flex; align-items: center; gap: 10px; padding: 12px 14px; border-radius: 10px; color: var(--text-secondary); margin-bottom: 4px; cursor: pointer; border: none; background: none; width: 100%; text-align: left; font-size: 14px; transition: 0.2s; }
    .menu-item:hover { background: var(--bg); }
    .menu-item.active { background: linear-gradient(135deg, var(--primary), #60a5fa); color: white; }
    .status { margin-top: auto; padding: 12px; background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.2); border-radius: 10px; }
    .status-dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; display: inline-block; margin-right: 8px; }
    .main { margin-left: 220px; height: 100vh; overflow-y: auto; padding: 24px 32px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    h1 { font-size: 24px; font-weight: 700; }
    .update-time { color: var(--text-muted); font-size: 13px; font-family: monospace; background: var(--bg-card); padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); }
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: var(--bg-card); border-radius: 14px; padding: 20px; border: 1px solid var(--border); transition: 0.2s; }
    .stat-card:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(59,130,246,0.15); }
    .stat-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; margin-bottom: 12px; }
    .stat-value { font-size: 28px; font-weight: 700; }
    .stat-label { color: var(--text-muted); font-size: 12px; margin-top: 4px; }
    .card { background: var(--bg-card); border-radius: 16px; padding: 22px; margin-bottom: 20px; border: 1px solid var(--border); }
    .card-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; }
    .chart { display: flex; align-items: flex-end; gap: 4px; height: 180px; padding: 12px 0; }
    .bar { flex: 1; background: linear-gradient(180deg, var(--primary), #60a5fa); border-radius: 4px 4px 0 0; min-height: 6px; position: relative; }
    .bar-label { position: absolute; bottom: -22px; left: 50%; transform: translateX(-50%); font-size: 10px; color: var(--text-muted); }
    .poly-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .poly-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; padding: 18px; }
    .poly-rank { background: var(--primary); color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; }
    .poly-date { color: var(--text-muted); font-size: 12px; }
    .poly-title { font-size: 13px; font-weight: 600; margin: 12px 0; line-height: 1.5; }
    .poly-vol { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 12px; }
    .poly-prices { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px; }
    .price-box { text-align: center; padding: 10px; border-radius: 8px; }
    .price-yes { background: rgba(16,185,129,0.12); border: 1px solid rgba(16,185,129,0.25); }
    .price-no { background: rgba(239,68,68,0.12); border: 1px solid rgba(239,68,68,0.25); }
    .price-label { font-size: 10px; color: var(--text-muted); }
    .price-value { font-size: 18px; font-weight: 700; }
    .price-yes .price-value { color: var(--green); }
    .price-no .price-value { color: var(--red); }
    .poly-link { display: block; text-align: center; background: var(--primary); color: white; padding: 10px; border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: 600; }
    .total-vol { background: linear-gradient(135deg, var(--primary), #06b6d4); color: white; padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; }
    .loading { text-align: center; padding: 60px; color: var(--text-muted); }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="logo"><div class="logo-icon">ğŸ¯</div><span class="logo-text">MUSK MONITOR</span></div>
    <button class="menu-item active" id="btn-dash">ğŸ“Š å®æ—¶æ¦‚è§ˆ</button>
    <button class="menu-item" id="btn-backend">ğŸ“ åç«¯æ•°æ®</button>
    <button class="menu-item" id="btn-poly">ğŸ¯ é¢„æµ‹å¸‚åœº</button>
    <div class="status"><span class="status-dot"></span><span style="font-size:12px;color:var(--green)">è¿è¡Œä¸­</span></div>
  </div>
  
  <div class="main" id="main">
    <div class="loading">åŠ è½½ä¸­...</div>
  </div>

  <script>
    let tweetData = {};
    let polyData = [];
    
    async function loadData() {
      try {
        const [tweetsRes, polyRes] = await Promise.all([fetch('/api'), fetch('/api/polymarket')]);
        tweetData = await tweetsRes.json();
        polyData = (await polyRes.json()).markets || [];
      } catch(e) { console.error(e); }
      showDashboard();
    }
    
    function showDashboard() {
      document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
      document.getElementById('btn-dash').classList.add('active');
      
      const daily = Object.entries(tweetData.daily||{}).sort((a,b)=>a[0].localeCompare(b[0])).slice(-14);
      const latest = daily[daily.length-1];
      const maxCount = Math.max(...daily.map(d=>d[1].count),1);
      
      document.getElementById('main').innerHTML = `
        <div class="header"><h1>ğŸ“Š å®æ—¶æ¦‚è§ˆ</h1><span class="update-time">æ›´æ–°: ${(tweetData.last_updated||'').slice(0,19)}</span></div>
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-icon" style="background:linear-gradient(135deg,#3b82f6,#60a5fa)">ğŸ¦</div><div class="stat-value">${latest?latest[1].count:0}</div><div class="stat-label">ä»Šæ—¥æ¨æ–‡</div></div>
          <div class="stat-card"><div class="stat-icon" style="background:linear-gradient(135deg,#8b5cf6,#a78bfa)">ğŸ“š</div><div class="stat-value">${tweetData.total_tweets||0}</div><div class="stat-label">æ€»æ¨æ–‡æ•°</div></div>
          <div class="stat-card"><div class="stat-icon" style="background:linear-gradient(135deg,#f59e0b,#fbbf24)">ğŸ“…</div><div class="stat-value">${daily.length}</div><div class="stat-label">æ•°æ®å¤©æ•°</div></div>
          <div class="stat-card"><div class="stat-icon" style="background:linear-gradient(135deg,#10b981,#34d399)">âœ…</div><div class="stat-value" style="color:var(--green)">æ­£å¸¸</div><div class="stat-label">ç³»ç»ŸçŠ¶æ€</div></div>
        </div>
        <div class="card"><div class="card-title">ğŸ“ˆ æ¨æ–‡è¶‹åŠ¿ (è¿‘14å¤©)</div><div class="chart">${daily.map(d=>`<div class="bar" style="height:${(d[1].count/maxCount)*150}px"><span class="bar-label">${d[0].slice(5)}</span></div>`).join('')}</div></div>
        <div class="card"><div class="card-title">ğŸ• ä»Šæ—¥å‘å¸ƒæ—¶æ®µ</div><div class="chart">${Array.from({length:24},(_,i)=>{const h=String(i).padStart(2,'0');const c=(latest&&latest[1].hourly&&latest[1].hourly[h])||0;const m=Math.max(...Object.values(latest?latest[1].hourly||{}:{}),1);return`<div class="bar" style="height:${(c/m)*150}px;background:linear-gradient(180deg,#8b5cf6,#a78bfa)"><span class="bar-label">${h}</span></div>`}).join('')}</div></div>
      `;
    }
    
    function showBackend() {
      document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
      document.getElementById('btn-backend').classList.add('active');
      
      const tweets = [];
      Object.entries(tweetData.daily||{}).forEach(([date,info])=>{(info.tweets||[]).forEach(t=>{tweets.push({date,time:t.time?.slice(11,19),content:t.content});});});
      
      document.getElementById('main').innerHTML = `
        <div class="header"><h1>ğŸ“ åç«¯æ•°æ®</h1></div>
        <div class="card"><div class="card-title">ğŸ“‹ åŸå§‹æ¨æ–‡ (${tweets.length}æ¡)</div>
        <table style="width:100%;border-collapse:collapse;"><tr style="border-bottom:2px solid var(--border)"><th style="text-align:left;padding:10px;color:var(--text-muted);font-size:12px;">æ—¥æœŸ</th><th style="text-align:left;padding:10px;color:var(--text-muted);font-size:12px;">æ—¶é—´</th><th style="text-align:left;padding:10px;color:var(--text-muted);font-size:12px;">å†…å®¹</th></tr>
        ${tweets.slice(0,50).map(t=>`<tr style="border-bottom:1px solid var(--border)"><td style="padding:12px;font-size:13px">${t.date}</td><td style="padding:12px;font-family:monospace;font-size:13px">${t.time}</td><td style="padding:12px;font-size:13px;max-width:400px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${t.content}</td></tr>`).join('')}
        </table></div>
      `;
    }
    
    function showPolymarket() {
      document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
      document.getElementById('btn-poly').classList.add('active');
      
      const totalVol = polyData.reduce((s,m)=>s+(m.volume||0),0);
      const top6 = polyData.slice(0,6);
      
      document.getElementById('main').innerHTML = `
        <div class="header"><h1>ğŸ¯ é¢„æµ‹å¸‚åœº</h1><span class="total-vol">æ€»äº¤æ˜“é‡: $${(totalVol/1000000).toFixed(2)}M</span></div>
        <div class="poly-grid">${top6.map((m,i)=>`
          <div class="poly-card">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;"><span class="poly-rank">#${i+1}</span><span class="poly-date">${m.end_date}</span></div>
            <div class="poly-title">${m.title}</div>
            <div class="poly-vol"><span style="color:var(--text-muted)">äº¤æ˜“é‡</span><span style="font-weight:700">${m.volume_display}</span></div>
            <div class="poly-prices">
              <div class="price-box price-yes"><div class="price-label">YES</div><div class="price-value">${m.yes_pct}%</div></div>
              <div class="price-box price-no"><div class="price-label">NO</div><div class="price-value">${m.no_pct}%</div></div>
            </div>
            <a href="${m.url}" target="_blank" class="poly-link">äº¤æ˜“ â†’</a>
          </div>
        `).join('')}</div>
      `;
    }
    
    document.getElementById('btn-dash').onclick = showDashboard;
    document.getElementById('btn-backend').onclick = showBackend;
    document.getElementById('btn-poly').onclick = showPolymarket;
    
    loadData();
  </script>
</body>
</html>
